{% extends "base.html" %}

{% block title %}AuNoo AI - Unified Feed Dashboard{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #FF69B4;
        --primary-dark: #FF1493;
        --secondary-color: #32CD32;
        --secondary-dark: #228B22;
        --text-color: #333;
        --light-gray: #f8f9fa;
        --medium-gray: #e9ecef;
        --dark-gray: #343a40;
        --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        --border-radius: 12px;
        --success-color: #28a745;
        --warning-color: #ffc107;
        --danger-color: #dc3545;
        --info-color: #17a2b8;
    }

    body {
        background-color: var(--light-gray);
    }

    h1, h2, h5, h6 {
        color: var(--primary-color);
    }

    /* Main Dashboard Layout */
    .dashboard-container {
        max-width: 1400px;
        margin: 0 auto;
        padding: 0 20px;
    }

    /* Header Section */
    .dashboard-header {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        padding: 24px;
        margin-bottom: 24px;
    }

    .dashboard-title {
        color: var(--primary-color);
        font-size: 2rem;
        font-weight: 600;
        margin: 0;
    }

    .dashboard-subtitle {
        color: var(--dark-gray);
        margin: 8px 0 0 0;
        font-size: 1.1rem;
    }

    /* Feed Group Tabs */
    .feed-tabs-container {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        margin-bottom: 24px;
        overflow: hidden;
    }

    .tab-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid var(--medium-gray);
    }

    .feed-tabs {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        padding: 0;
        margin: 0;
        list-style: none;
    }

    .feed-tab {
        background: var(--light-gray);
        border: 1px solid var(--medium-gray);
        border-radius: 8px;
        padding: 12px 16px;
        cursor: pointer;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 500;
        position: relative;
    }

    .feed-tab:hover {
        background: var(--medium-gray);
        transform: translateY(-1px);
    }

    .feed-tab.active {
        background: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
    }

    .feed-tab.active:hover {
        background: var(--primary-dark);
        border-color: var(--primary-dark);
    }

    .tab-color {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        flex-shrink: 0;
    }

    .tab-count {
        background: rgba(255, 255, 255, 0.2);
        border-radius: 12px;
        padding: 2px 8px;
        font-size: 0.85rem;
        font-weight: 600;
    }

    .feed-tab.active .tab-count {
        background: rgba(255, 255, 255, 0.3);
    }

    /* Tab Controls */
    .tab-controls {
        display: flex;
        gap: 12px;
        align-items: center;
    }

    .btn-tab-control {
        padding: 8px 16px;
        border-radius: 8px;
        border: 1px solid var(--medium-gray);
        background: white;
        color: var(--text-color);
        font-size: 0.9rem;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        gap: 6px;
    }

    .btn-tab-control:hover {
        border-color: var(--primary-color);
        color: var(--primary-color);
        transform: translateY(-1px);
    }

    .btn-primary-control {
        background: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
    }

    .btn-primary-control:hover {
        background: var(--primary-dark);
        border-color: var(--primary-dark);
        color: white;
    }

    /* Feed Content Area */
    .feed-content {
        background: white;
        border-radius: var(--border-radius);
        box-shadow: var(--card-shadow);
        min-height: 600px;
    }

    /* Feed Controls */
    .feed-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 24px;
        border-bottom: 1px solid var(--medium-gray);
        flex-wrap: wrap;
        gap: 16px;
    }

    .feed-controls-left {
        display: flex;
        align-items: center;
        gap: 16px;
        flex-wrap: wrap;
    }

    .feed-controls-right {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .feed-filter {
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .filter-select {
        border: 1px solid var(--medium-gray);
        border-radius: 6px;
        padding: 8px 12px;
        background: white;
        min-width: 120px;
    }

    .filter-select:focus {
        border-color: var(--primary-color);
        outline: none;
        box-shadow: 0 0 0 2px rgba(255, 105, 180, 0.2);
    }

    /* Feed Items */
    .feed-items {
        padding: 24px;
    }

    .feed-item {
        background: white;
        border: 1px solid var(--medium-gray);
        border-radius: 8px;
        padding: 20px;
        margin-bottom: 20px;
        transition: all 0.2s;
        position: relative;
    }

    .feed-item:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .feed-item-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 12px;
    }

    .feed-item-source {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
        color: var(--dark-gray);
    }

    .source-icon {
        width: 20px;
        height: 20px;
        border-radius: 4px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 0.8rem;
    }

    .source-arxiv {
        background: #b31b1b;
    }

    .source-bluesky {
        background: #0085ff;
    }

    .feed-item-actions {
        display: flex;
        gap: 8px;
    }

    .btn-item-action {
        padding: 6px 10px;
        border: none;
        border-radius: 6px;
        background: var(--light-gray);
        color: var(--dark-gray);
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.85rem;
    }

    .btn-item-action:hover {
        background: var(--medium-gray);
    }

    .btn-item-action.active {
        background: var(--primary-color);
        color: white;
    }

    .feed-item-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: var(--text-color);
        margin-bottom: 12px;
        line-height: 1.4;
    }

    .feed-item-title a {
        color: inherit;
        text-decoration: none;
    }

    .feed-item-title a:hover {
        color: var(--primary-color);
    }

    .feed-item-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        margin-bottom: 12px;
        font-size: 0.9rem;
        color: var(--dark-gray);
    }

    .meta-item {
        display: flex;
        align-items: center;
        gap: 4px;
    }

    .feed-item-content {
        color: var(--text-color);
        line-height: 1.6;
        margin-bottom: 16px;
    }

    .feed-item-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 16px;
        padding-top: 16px;
        border-top: 1px solid var(--light-gray);
    }

    .engagement-metrics {
        display: flex;
        gap: 16px;
    }

    .metric {
        display: flex;
        align-items: center;
        gap: 4px;
        padding: 4px 8px;
        background: var(--light-gray);
        border-radius: 4px;
        font-size: 0.85rem;
        color: var(--dark-gray);
    }

    .metric i {
        color: var(--primary-color);
    }

    .feed-item-tags {
        display: flex;
        gap: 6px;
        flex-wrap: wrap;
    }

    .tag {
        background: var(--light-gray);
        color: var(--dark-gray);
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 0.8rem;
        border: 1px solid var(--medium-gray);
    }

    /* Loading States */
    .loading-container {
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 60px;
        flex-direction: column;
        gap: 16px;
    }

    .loading-spinner {
        width: 40px;
        height: 40px;
        border: 4px solid var(--light-gray);
        border-top: 4px solid var(--primary-color);
        border-radius: 50%;
        animation: spin 1s linear infinite;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    /* Empty State */
    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: var(--dark-gray);
    }

    .empty-state i {
        font-size: 3rem;
        color: var(--medium-gray);
        margin-bottom: 16px;
    }

    .empty-state h3 {
        color: var(--dark-gray);
        margin-bottom: 8px;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
        .dashboard-container {
            padding: 0 16px;
        }

        .feed-tabs {
            flex-direction: column;
            width: 100%;
        }

        .feed-tab {
            justify-content: center;
        }

        .feed-controls {
            flex-direction: column;
            align-items: stretch;
        }

        .feed-controls-left,
        .feed-controls-right {
            justify-content: center;
        }

        .feed-item-header {
            flex-direction: column;
            gap: 12px;
        }

        .feed-item-actions {
            align-self: flex-end;
        }

        .feed-item-footer {
            flex-direction: column;
            gap: 12px;
            align-items: stretch;
        }

        .engagement-metrics {
            justify-content: center;
        }
    }

    /* Animations */
    .fade-in {
        animation: fadeIn 0.3s ease-in;
    }

    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .slide-in {
        animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
        from { transform: translateX(-20px); opacity: 0; }
        to { transform: translateX(0); opacity: 1; }
    }
</style>
{% endblock %}

{% block content %}
<div class="dashboard-container mt-4">
    <!-- Dashboard Header -->
    <div class="dashboard-header">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="dashboard-title">Unified Feed Dashboard</h1>
                <p class="dashboard-subtitle">Social media and academic content in one place</p>
            </div>
            <div class="d-flex gap-2">
                <button class="btn-tab-control" onclick="refreshCurrentFeed()">
                    <i class="fas fa-sync-alt"></i>
                    Refresh
                </button>
                <button class="btn-tab-control btn-primary-control" onclick="openFeedGroupManager()">
                    <i class="fas fa-cog"></i>
                    Manage Groups
                </button>
            </div>
        </div>
    </div>

    <!-- Feed Group Tabs -->
    <div class="feed-tabs-container">
        <div class="tab-header">
            <ul class="feed-tabs" id="feedTabs">
                <!-- Tabs will be populated by JavaScript -->
            </ul>
            <div class="tab-controls">
                <button class="btn-tab-control" onclick="collectFeedItems()">
                    <i class="fas fa-download"></i>
                    Collect New
                </button>
                <button class="btn-tab-control" onclick="createNewFeedGroup()">
                    <i class="fas fa-plus"></i>
                    New Group
                </button>
            </div>
        </div>
    </div>

    <!-- Feed Content Area -->
    <div class="feed-content">
        <!-- Feed Controls -->
        <div class="feed-controls">
            <div class="feed-controls-left">
                <div class="feed-filter">
                    <label for="sourceFilter">Source:</label>
                    <select id="sourceFilter" class="filter-select" onchange="applyFilters()">
                        <option value="">All Sources</option>
                        <option value="bluesky">Bluesky</option>
                        <option value="arxiv">ArXiv</option>
                    </select>
                </div>
                <div class="feed-filter">
                    <label for="sortBy">Sort by:</label>
                    <select id="sortBy" class="filter-select" onchange="applyFilters()">
                        <option value="publication_date">Newest First</option>
                        <option value="created_at">Recently Added</option>
                        <option value="engagement">Most Engagement</option>
                    </select>
                </div>
            </div>
            <div class="feed-controls-right">
                <div class="feed-filter">
                    <label for="itemsPerPage">Show:</label>
                    <select id="itemsPerPage" class="filter-select" onchange="applyFilters()">
                        <option value="20">20 items</option>
                        <option value="50" selected>50 items</option>
                        <option value="100">100 items</option>
                    </select>
                </div>
                <button class="btn-tab-control" onclick="toggleHiddenItems()">
                    <i class="fas fa-eye-slash"></i>
                    <span id="hiddenToggleText">Show Hidden</span>
                </button>
            </div>
        </div>

        <!-- Feed Items -->
        <div class="feed-items" id="feedItems">
            <!-- Feed items will be populated by JavaScript -->
            <div class="loading-container">
                <div class="loading-spinner"></div>
                <p>Loading your unified feed...</p>
            </div>
        </div>

        <!-- Load More Button -->
        <div class="text-center p-4" id="loadMoreContainer" style="display: none;">
            <button class="btn-tab-control btn-primary-control" onclick="loadMoreItems()">
                <i class="fas fa-chevron-down"></i>
                Load More Items
            </button>
        </div>
    </div>
</div>

<!-- Feed Group Manager Modal -->
<div class="modal fade" id="feedGroupModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Manage Feed Groups</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="feedGroupManager">
                    <!-- Manager content will be populated by JavaScript -->
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Create/Edit Feed Group Modal -->
<div class="modal fade" id="editFeedGroupModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="editFeedGroupTitle">Create Feed Group</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="feedGroupForm">
                    <div class="mb-3">
                        <label for="groupName" class="form-label">Group Name</label>
                        <input type="text" class="form-control" id="groupName" required>
                    </div>
                    <div class="mb-3">
                        <label for="groupDescription" class="form-label">Description</label>
                        <textarea class="form-control" id="groupDescription" rows="3"></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="groupColor" class="form-label">Color</label>
                        <input type="color" class="form-control form-control-color" id="groupColor" value="#FF69B4">
                    </div>
                    <input type="hidden" id="editingGroupId">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary" onclick="saveFeedGroup()">Save Group</button>
            </div>
        </div>
    </div>
</div>

<script>
// Global state management
let currentFeedGroup = null;
let feedGroups = [];
let feedItems = [];
let currentPage = 0;
let hasMoreItems = true;
let showHidden = false;
let currentFilters = {
    source: '',
    sort: 'publication_date',
    limit: 50
};

// Initialize dashboard when page loads
document.addEventListener('DOMContentLoaded', function() {
    initializeDashboard();
});

async function initializeDashboard() {
    try {
        await loadFeedGroups();
        if (feedGroups.length > 0) {
            currentFeedGroup = feedGroups[0].id;
            renderFeedTabs();
            await loadFeedItems();
        } else {
            renderEmptyState();
        }
    } catch (error) {
        console.error('Error initializing dashboard:', error);
        showError('Failed to load dashboard. Please refresh the page.');
    }
}

async function loadFeedGroups() {
    try {
        const response = await fetch('/api/feed-groups');
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        feedGroups = await response.json();
        console.log('Loaded feed groups:', feedGroups);
    } catch (error) {
        console.error('Error loading feed groups:', error);
        throw error;
    }
}

function renderFeedTabs() {
    const tabsContainer = document.getElementById('feedTabs');
    
    if (feedGroups.length === 0) {
        tabsContainer.innerHTML = '<li class="feed-tab">No feed groups available</li>';
        return;
    }
    
    tabsContainer.innerHTML = feedGroups.map(group => `
        <li class="feed-tab ${group.id === currentFeedGroup ? 'active' : ''}" 
            onclick="switchFeedGroup(${group.id})"
            data-group-id="${group.id}">
            <div class="tab-color" style="background-color: ${group.color}"></div>
            <span>${group.name}</span>
            <span class="tab-count" id="count-${group.id}">0</span>
        </li>
    `).join('');
    
    // Add "All Groups" tab
    tabsContainer.innerHTML = `
        <li class="feed-tab ${currentFeedGroup === null ? 'active' : ''}" 
            onclick="switchFeedGroup(null)"
            data-group-id="all">
            <i class="fas fa-globe"></i>
            <span>All Groups</span>
            <span class="tab-count" id="count-all">0</span>
        </li>
    ` + tabsContainer.innerHTML;
}

async function switchFeedGroup(groupId) {
    currentFeedGroup = groupId;
    currentPage = 0;
    hasMoreItems = true;
    
    // Update tab active states
    document.querySelectorAll('.feed-tab').forEach(tab => {
        const tabGroupId = tab.dataset.groupId;
        const isActive = (groupId === null && tabGroupId === 'all') || 
                        (groupId !== null && parseInt(tabGroupId) === groupId);
        tab.classList.toggle('active', isActive);
    });
    
    await loadFeedItems();
}

async function loadFeedItems(append = false) {
    try {
        if (!append) {
            document.getElementById('feedItems').innerHTML = `
                <div class="loading-container">
                    <div class="loading-spinner"></div>
                    <p>Loading feed items...</p>
                </div>
            `;
        }
        
        const params = new URLSearchParams({
            limit: currentFilters.limit,
            offset: currentPage * currentFilters.limit,
            include_hidden: showHidden
        });
        
        if (currentFilters.source) {
            params.append('source_types', currentFilters.source);
        }
        
        let endpoint = '/api/unified-feed';
        if (currentFeedGroup !== null) {
            endpoint = `/api/feed-groups/${currentFeedGroup}/feed`;
        }
        
        const response = await fetch(`${endpoint}?${params}`);
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        const data = await response.json();
        
        if (append) {
            feedItems = [...feedItems, ...data.items];
        } else {
            feedItems = data.items;
        }
        
        hasMoreItems = data.has_more;
        renderFeedItems();
        updateLoadMoreButton();
        
    } catch (error) {
        console.error('Error loading feed items:', error);
        showError('Failed to load feed items. Please try again.');
    }
}

function renderFeedItems() {
    const container = document.getElementById('feedItems');
    
    if (feedItems.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <i class="fas fa-rss"></i>
                <h3>No feed items yet</h3>
                <p>Try collecting new items or check your feed group sources.</p>
                <button class="btn-tab-control btn-primary-control" onclick="collectFeedItems()">
                    <i class="fas fa-download"></i>
                    Collect Items
                </button>
            </div>
        `;
        return;
    }
    
    container.innerHTML = feedItems.map(item => renderFeedItem(item)).join('');
}

function renderFeedItem(item) {
    const publishDate = item.publication_date ? 
        new Date(item.publication_date).toLocaleDateString() : 
        'No date';
    
    const sourceIcon = item.source_type === 'arxiv' ? 
        '<div class="source-icon source-arxiv">A</div>' :
        '<div class="source-icon source-bluesky">B</div>';
    
    const engagement = item.engagement_metrics || {};
    const tags = item.tags || [];
    
    return `
        <div class="feed-item fade-in" data-item-id="${item.id}">
            <div class="feed-item-header">
                <div class="feed-item-source">
                    ${sourceIcon}
                    <span>${item.source_type.toUpperCase()}</span>
                    <span>â€¢</span>
                    <span style="color: ${item.group_color}">${item.group_name}</span>
                </div>
                <div class="feed-item-actions">
                    <button class="btn-item-action ${item.is_starred ? 'active' : ''}" 
                            onclick="toggleStar(${item.id}, ${!item.is_starred})"
                            title="${item.is_starred ? 'Unstar' : 'Star'} item">
                        <i class="fas fa-star"></i>
                    </button>
                    <button class="btn-item-action" 
                            onclick="hideItem(${item.id})"
                            title="Hide item">
                        <i class="fas fa-eye-slash"></i>
                    </button>
                </div>
            </div>
            
            <h3 class="feed-item-title">
                <a href="${item.url}" target="_blank">${item.title}</a>
            </h3>
            
            <div class="feed-item-meta">
                ${item.author ? `<div class="meta-item"><i class="fas fa-user"></i> ${item.author}</div>` : ''}
                <div class="meta-item"><i class="fas fa-calendar"></i> ${publishDate}</div>
                ${item.author_handle ? `<div class="meta-item"><i class="fab fa-at"></i> ${item.author_handle}</div>` : ''}
            </div>
            
            ${item.content ? `<div class="feed-item-content">${truncateText(item.content, 300)}</div>` : ''}
            
            <div class="feed-item-footer">
                <div class="engagement-metrics">
                    ${engagement.likes ? `<div class="metric"><i class="fas fa-heart"></i> ${engagement.likes}</div>` : ''}
                    ${engagement.reposts ? `<div class="metric"><i class="fas fa-retweet"></i> ${engagement.reposts}</div>` : ''}
                    ${engagement.replies ? `<div class="metric"><i class="fas fa-reply"></i> ${engagement.replies}</div>` : ''}
                </div>
                <div class="feed-item-tags">
                    ${tags.slice(0, 3).map(tag => `<span class="tag">${tag}</span>`).join('')}
                    ${tags.length > 3 ? `<span class="tag">+${tags.length - 3} more</span>` : ''}
                </div>
            </div>
        </div>
    `;
}

function truncateText(text, maxLength) {
    if (text.length <= maxLength) return text;
    return text.substring(0, maxLength) + '...';
}

async function toggleStar(itemId, starred) {
    try {
        const response = await fetch(`/api/feed-items/${itemId}/star`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(starred)
        });
        
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        // Update local state
        const item = feedItems.find(item => item.id === itemId);
        if (item) {
            item.is_starred = starred;
            renderFeedItems();
        }
        
    } catch (error) {
        console.error('Error toggling star:', error);
        showError('Failed to update item. Please try again.');
    }
}

async function hideItem(itemId) {
    try {
        const response = await fetch(`/api/feed-items/${itemId}/hide`, {
            method: 'POST'
        });
        
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        // Remove from current view if not showing hidden items
        if (!showHidden) {
            feedItems = feedItems.filter(item => item.id !== itemId);
            renderFeedItems();
        }
        
    } catch (error) {
        console.error('Error hiding item:', error);
        showError('Failed to hide item. Please try again.');
    }
}

async function collectFeedItems() {
    try {
        showSuccess('Collecting new feed items...');
        
        let endpoint = '/api/feed-collection/collect-all';
        if (currentFeedGroup !== null) {
            endpoint = `/api/feed-groups/${currentFeedGroup}/collect?max_items=20`;
        }
        
        const response = await fetch(endpoint, { method: 'POST' });
        if (!response.ok) throw new Error(`HTTP ${response.status}`);
        
        const result = await response.json();
        showSuccess(`Collected ${result.total_items_collected || result.items_collected || 0} new items`);
        
        // Refresh the current feed
        await loadFeedItems();
        
    } catch (error) {
        console.error('Error collecting feed items:', error);
        showError('Failed to collect new items. Please try again.');
    }
}

function applyFilters() {
    currentFilters.source = document.getElementById('sourceFilter').value;
    currentFilters.sort = document.getElementById('sortBy').value;
    currentFilters.limit = parseInt(document.getElementById('itemsPerPage').value);
    
    currentPage = 0;
    hasMoreItems = true;
    loadFeedItems();
}

function toggleHiddenItems() {
    showHidden = !showHidden;
    document.getElementById('hiddenToggleText').textContent = showHidden ? 'Hide Hidden' : 'Show Hidden';
    
    currentPage = 0;
    hasMoreItems = true;
    loadFeedItems();
}

function loadMoreItems() {
    if (hasMoreItems) {
        currentPage++;
        loadFeedItems(true);
    }
}

function updateLoadMoreButton() {
    const container = document.getElementById('loadMoreContainer');
    container.style.display = hasMoreItems ? 'block' : 'none';
}

function refreshCurrentFeed() {
    currentPage = 0;
    hasMoreItems = true;
    loadFeedItems();
}

// Feed Group Management Functions
function openFeedGroupManager() {
    // This would open the management modal
    // Implementation depends on your modal system
    alert('Feed group management interface would open here');
}

function createNewFeedGroup() {
    // This would open the create group modal
    // Implementation depends on your modal system
    alert('Create new feed group interface would open here');
}

// Utility functions
function showSuccess(message) {
    // Implement your success notification system
    console.log('Success:', message);
}

function showError(message) {
    // Implement your error notification system
    console.error('Error:', message);
}

function renderEmptyState() {
    document.getElementById('feedItems').innerHTML = `
        <div class="empty-state">
            <i class="fas fa-rss"></i>
            <h3>Welcome to Your Unified Feed!</h3>
            <p>Create your first feed group to start aggregating content from social media and academic sources.</p>
            <button class="btn-tab-control btn-primary-control" onclick="createNewFeedGroup()">
                <i class="fas fa-plus"></i>
                Create Your First Group
            </button>
        </div>
    `;
}
</script>
{% endblock %} 