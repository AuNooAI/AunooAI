{% extends "base.html" %}

{% block title %}AuNoo AI - Home{% endblock %}

{% block extra_css %}
<style>
    :root {
        --primary-color: #FF69B4;  /* Hot Pink */
        --primary-dark: #FF1493;   /* Deep Pink */
        --secondary-color: #32CD32;  /* Lime Green */
        --secondary-dark: #228B22;   /* Forest Green */
        --text-color: #333;
        --light-gray: #f8f9fa;
        --medium-gray: #e9ecef;
        --dark-gray: #343a40;
    }

    body {
        background-color: var(--light-gray);
        color: var(--text-color);
    }

    .container {
        max-width: 1400px;
        padding: 40px 20px;
    }

    h1 {
        color: var(--primary-color);
        margin-bottom: 20px;
    }

    .lead {
        color: var(--dark-gray);
    }

    .card {
        background-color: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        margin-bottom: 20px;
        border: 1px solid var(--medium-gray);
        transition: transform 0.2s ease;
    }

    .card:hover {
        transform: translateY(-2px);
    }

    .card-header {
        background-color: #fff;
        border-bottom: 1px solid var(--medium-gray);
        padding: 1rem 1.25rem;
    }

    .card-header h5 {
        color: var(--text-color);
        font-size: 1.1rem;
        font-weight: 600;
        margin: 0;
    }

    .card-body {
        padding: 1.25rem;
    }

    .card-title {
        color: var(--primary-color);
        font-size: 1.25rem;
        font-weight: bold;
        margin-bottom: 10px;
    }

    .card-text {
        color: var(--dark-gray);
        margin-bottom: 15px;
    }

    .btn-primary {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: #fff;
        transition: all 0.2s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: flex-start;
        padding: 8px 16px;
    }

    .btn-primary:hover {
        background-color: var(--primary-dark);
        border-color: var(--primary-dark);
        transform: translateY(-1px);
    }

    .btn-primary i {
        width: 16px;
        text-align: center;
    }

    .form-control, .form-select {
        width: 100%;
        padding: 8px;
        margin-bottom: 15px;
        border: 1px solid var(--primary-color);
        border-radius: 4px;
    }

    .form-control:focus, .form-select:focus {
        border-color: var(--primary-dark);
        box-shadow: 0 0 0 0.2rem rgba(255, 105, 180, 0.25);
    }

    #articleForm {
        background-color: #fff;
        padding: 20px;
        border-radius: 8px;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border: 1px solid var(--primary-color);
        margin-top: 30px;
    }

    #articleForm h2 {
        color: var(--primary-color);
        margin-bottom: 20px;
    }

    .btn-success {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
        color: #fff;
    }

    .btn-success:hover {
        background-color: var(--secondary-dark);
        border-color: var(--secondary-dark);
    }

    .btn-secondary {
        background-color: var(--medium-gray);
        border-color: var(--medium-gray);
        color: var(--dark-gray);
    }

    .btn-secondary:hover {
        background-color: var(--dark-gray);
        border-color: var(--dark-gray);
        color: #fff;
    }

    .world-clock {
        max-width: 100%;
        padding: 15px;
        margin: 0 auto;
        display: flex;
        flex-wrap: wrap;
        gap: 15px;
        justify-content: center;
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .clock-item {
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 15px;
        min-width: 140px;
        border-radius: 8px;
        background: var(--light-gray);
        transition: all 0.2s ease;
    }

    .clock-item:hover {
        transform: translateY(-2px);
        background: white;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .clock-city {
        font-size: 0.85rem;
        font-weight: 600;
        color: var(--dark-gray);
        margin-bottom: 2px;
    }

    .clock-time {
        font-size: 1.1rem;
        font-weight: 500;
        color: var(--primary-color);
        font-variant-numeric: tabular-nums;
    }

    .clock-date {
        font-size: 0.75rem;
        color: var(--text-color);
        opacity: 0.7;
    }

    .card {
        border: none;
        border-radius: 15px;
        box-shadow: 0 10px 20px rgba(0,0,0,0.08);
        height: 100%;
    }

    .card-body {
        padding: 30px;
    }

    .card-title {
        font-size: 1.5rem;
        margin-bottom: 20px;
        border-bottom: 2px solid var(--primary-color);
        padding-bottom: 10px;
    }

    .button-group {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
    }

    .btn {
        border-radius: 25px;
        padding: 10px 20px;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-size: 0.9rem;
    }

    .table-responsive {
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 0 10px rgba(0,0,0,0.05);
    }

    .table {
        margin: 0;
    }

    .table thead th {
        background: var(--primary-color);
        color: white;
        border: none;
        padding: 15px;
    }

    .table tbody td {
        padding: 12px 15px;
        border-color: var(--light-gray);
    }

    .table tbody tr:hover {
        background-color: var(--light-gray);
    }

    @media (max-width: 768px) {
        .site-header {
            border-radius: 0;
        }
        
        .world-clock {
            margin: 0 0 30px;
            padding: 15px;
        }
        
        .clock-item {
            min-width: 140px;
        }
    }

    /* Enhanced World Clock Section */
    .world-clock-section {
        margin-bottom: 15px;
    }

    .world-clock-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 15px;
        padding: 0 20px;
    }

    .world-clock-header i {
        color: var(--primary-color);
        font-size: 1.2em;
    }

    .world-clock-header h2 {
        color: var(--dark-gray);
        font-size: 1.5rem;
        margin: 0;
    }

    /* Soften Active Topic Overview */
    .topic-overview-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        overflow: hidden;
        margin-bottom: 30px;
    }

    .topic-overview-card .card-title {
        color: var(--dark-gray);
        border-bottom: none;
        padding: 20px;
        margin: 0;
        background: var(--light-gray);
    }

    .table thead th {
        background: var(--light-gray);
        color: var(--dark-gray);
        font-weight: 600;
        border-bottom: 2px solid var(--medium-gray);
    }

    .table tbody tr:hover {
        background-color: var(--light-gray);
    }

    .table td, .table th {
        padding: 15px 20px;
        border-color: var(--light-gray);
    }

    /* Consistent Section Headers */
    .section-header {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-bottom: 12px;
        padding: 0 20px;
    }

    .section-header i {
        color: var(--primary-color);
        font-size: 1.2em;
    }

    .section-header h2 {
        color: var(--dark-gray);
        font-size: 1.5rem;
        margin: 0;
    }

    /* Remove old card-title styling */
    .topic-overview-card .card-title {
        display: none;
    }

    /* Update card headers to match */
    .card-title {
        color: var(--dark-gray);
        font-size: 1.5rem;
        margin: 0;
        padding: 0;
        border-bottom: none;
    }

    .container.mt-2 {
        padding-top: 15px;
    }

    .current-date {
        color: var(--dark-gray);
        font-size: 1.1rem;
        margin-left: auto;
        font-weight: 500;
    }

    .panel {
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        height: 100%;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .panel-header {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .panel-header i {
        font-size: 24px;
        color: var(--primary-color);
    }

    .panel-header h2 {
        font-size: 24px;
        font-weight: 500;
        color: var(--text-color);
        margin: 0;
    }

    .panel-description {
        color: var(--dark-gray);
        margin-bottom: 20px;
        font-size: 0.95rem;
    }

    .panel-actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .action-button {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 10px 16px;
        background-color: var(--light-gray);
        border: none;
        border-radius: 6px;
        color: var(--text-color);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .action-button:hover {
        background-color: var(--primary-color);
        color: white;
        transform: translateY(-1px);
        text-decoration: none;
    }

    .action-button i {
        width: 20px;
        text-align: center;
    }

    /* Update container padding */
    .container.mt-4 {
        padding-top: 20px;
        padding-bottom: 40px;
    }

    .flex-1 {
        flex: 1;
    }

    /* Update action button styles for horizontal layout */
    .d-flex .action-button {
        text-align: center;
        justify-content: center;
        padding: 12px 20px;
        background-color: var(--light-gray);
        border: none;
        border-radius: 6px;
        color: var(--text-color);
        text-decoration: none;
        font-size: 0.9rem;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .d-flex .action-button:hover {
        background-color: var(--primary-color);
        color: white;
        transform: translateY(-1px);
        text-decoration: none;
    }

    .d-flex .action-button i {
        margin-right: 8px;
    }

    /* Update the badge styles to match keyword_alerts.html */
    .badge {
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 0.35em 0.8em !important;
        font-size: 0.75em !important;
        font-weight: 500 !important;
        line-height: 1.4 !important;
        text-align: center !important;
        white-space: nowrap !important;
        vertical-align: baseline !important;
        border-radius: 12px !important;
        margin-right: 0.4rem !important;
        box-shadow: 0 1px 2px rgba(0,0,0,0.05) !important;
        letter-spacing: 0.02em !important;
    }

    /* Softer colors for badges */
    .badge.bg-primary {
        background-color: rgba(13, 110, 253, 0.1) !important;
        color: #0d6efd !important;
        border: 1px solid rgba(13, 110, 253, 0.2) !important;
    }

    .badge.bg-info {
        background-color: rgba(23, 162, 184, 0.1) !important;
        color: #17a2b8 !important;
        border: 1px solid rgba(23, 162, 184, 0.2) !important;
    }

    .badge.bg-secondary {
        background-color: rgba(108, 117, 125, 0.1) !important;
        color: #6c757d !important;
        border: 1px solid rgba(108, 117, 125, 0.2) !important;
    }

    .badge.bg-success {
        background-color: rgba(40, 167, 69, 0.1) !important;
        color: #28a745 !important;
        border: 1px solid rgba(40, 167, 69, 0.2) !important;
    }

    .badge.bg-warning {
        background-color: rgba(255, 193, 7, 0.1) !important;
        color: #d39e00 !important;
        border: 1px solid rgba(255, 193, 7, 0.2) !important;
    }

    .badge.bg-danger {
        background-color: rgba(220, 53, 69, 0.1) !important;
        color: #dc3545 !important;
        border: 1px solid rgba(220, 53, 69, 0.2) !important;
    }

    /* Update the success/warning/danger classes to match */
    .badge.success {
        background-color: rgba(40, 167, 69, 0.1) !important;
        color: #28a745 !important;
        border: 1px solid rgba(40, 167, 69, 0.2) !important;
    }

    .badge.warning {
        background-color: rgba(255, 193, 7, 0.1) !important;
        color: #d39e00 !important;
        border: 1px solid rgba(255, 193, 7, 0.2) !important;
    }

    .badge.danger {
        background-color: rgba(220, 53, 69, 0.1) !important;
        color: #dc3545 !important;
        border: 1px solid rgba(220, 53, 69, 0.2) !important;
    }

    /* Icon styling within badges */
    .badge i {
        font-size: 0.85em !important;
        margin-right: 0.3em !important;
        opacity: 0.8 !important;
    }

    /* Tooltip styles */
    [data-tooltip] {
        position: relative;
        cursor: help;
    }

    [data-tooltip]:hover::before {
        content: attr(data-tooltip);
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        padding: 8px 12px;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        font-size: 0.8rem;
        border-radius: 6px;
        white-space: nowrap;
        z-index: 1000;
        margin-bottom: 5px;
    }

    [data-tooltip]:hover::after {
        content: '';
        position: absolute;
        bottom: 100%;
        left: 50%;
        transform: translateX(-50%);
        border: 6px solid transparent;
        border-top-color: rgba(0, 0, 0, 0.8);
        margin-bottom: -6px;
    }

    /* Enhanced stat card styles */
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        border: 1px solid var(--medium-gray);
    }

    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .stat-icon {
        color: var(--primary-color);
        opacity: 0.8;
        font-size: 1.5rem;
        margin-bottom: 10px;
    }

    .stat-value {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--dark-gray);
    }

    .stat-label {
        color: var(--text-color);
        font-size: 0.9rem;
        opacity: 0.8;
    }

    /* Status badge styles */
    .status-badges .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 8px 12px;
        font-weight: 500;
        font-size: 0.85rem;
    }

    .time-info {
        font-size: 0.9rem;
    }

    .current-time {
        font-weight: 500;
        color: var(--dark-gray);
    }

    .current-date {
        font-size: 0.8rem;
    }

    .list-group-item {
        transition: all 0.2s ease;
        border-left: 3px solid transparent;
    }

    .list-group-item:hover {
        border-left-color: var(--primary-color);
        background-color: rgba(13, 110, 253, 0.05);
        transform: translateX(3px);
    }

    .list-group-item i {
        opacity: 0.7;
        transition: opacity 0.2s ease;
    }

    .list-group-item:hover i {
        opacity: 1;
    }

    .card {
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    .card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    .badge i {
        font-size: 0.85em;
        margin-right: 0.3em;
    }

    .topic-details {
        background-color: var(--light-gray);
        border-radius: 8px;
        padding: 15px;
    }

    .info-item {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .info-label {
        color: var(--dark-gray);
        font-weight: 500;
    }

    .info-value {
        color: var(--primary-color);
    }

    .btn-outline-primary {
        background-color: rgba(13, 110, 253, 0.1);
        border: 1px solid rgba(13, 110, 253, 0.2);
        color: var(--primary-color);
        transition: all 0.2s ease;
    }

    .btn-outline-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        transform: translateY(-1px);
    }

    /* Add these styles */
    .topic-section {
        border: 1px solid var(--medium-gray);
        border-radius: 8px;
        margin-bottom: 1rem;
    }

    .topic-overview {
        cursor: pointer;
        padding: 1rem;
        background-color: var(--light-gray);
        border-radius: 8px 8px 0 0;
    }

    .topic-overview:hover {
        background-color: rgba(13, 110, 253, 0.05);
    }

    .topic-content {
        border-top: 1px solid var(--medium-gray);
        background-color: white;
        border-radius: 0 0 8px 8px;
    }

    .cursor-pointer {
        cursor: pointer;
    }

    .btn-soft-primary {
        background-color: rgba(13, 110, 253, 0.1);
        border: 1px solid rgba(13, 110, 253, 0.2);
        color: var(--primary-color);
        transition: all 0.2s ease;
    }

    .btn-soft-primary:hover {
        background-color: var(--primary-color);
        border-color: var(--primary-color);
        color: white;
        transform: translateY(-1px);
    }

    .bg-soft-primary {
        background-color: rgba(13, 110, 253, 0.1);
        color: var(--primary-color);
    }

    .topic-icon {
        width: 28px;
        height: 28px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 6px;
        background-color: rgba(13, 110, 253, 0.1);
    }

    .table > :not(caption) > * > * {
        padding: 1rem;
    }

    .btn-group .btn {
        margin: 0 2px;
    }

    .btn-group .btn:hover {
        transform: translateY(-1px);
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1>Control Room</h1>
            <p class="text-muted">What is going on in the world?</p>
        </div>
    </div>

    <!-- World Clock Section -->
    <div class="card mb-4">
        <div class="card-header">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-globe"></i> World Clock
                </h5>
                <span class="text-muted" id="localTime"></span>
            </div>
        </div>
        <div class="card-body">
            <div class="world-clock">
                <div class="clock-item" data-timezone="America/Los_Angeles">
                    <div class="clock-city">San Francisco</div>
                    <div class="clock-time"></div>
                    <div class="clock-date"></div>
                </div>
                <div class="clock-item" data-timezone="America/New_York">
                    <div class="clock-city">New York</div>
                    <div class="clock-time"></div>
                    <div class="clock-date"></div>
                </div>
                <div class="clock-item" data-timezone="Europe/London">
                    <div class="clock-city">London</div>
                    <div class="clock-time"></div>
                    <div class="clock-date"></div>
                </div>
                <div class="clock-item" data-timezone="Europe/Berlin">
                    <div class="clock-city">Berlin</div>
                    <div class="clock-time"></div>
                    <div class="clock-date"></div>
                </div>
                <div class="clock-item" data-timezone="Europe/Moscow">
                    <div class="clock-city">Moscow</div>
                    <div class="clock-time"></div>
                    <div class="clock-date"></div>
                </div>
                <div class="clock-item" data-timezone="Asia/Dubai">
                    <div class="clock-city">Dubai</div>
                    <div class="clock-time"></div>
                    <div class="clock-date"></div>
                </div>
                <div class="clock-item" data-timezone="Asia/Shanghai">
                    <div class="clock-city">Beijing</div>
                    <div class="clock-time"></div>
                    <div class="clock-date"></div>
                </div>
                <div class="clock-item" data-timezone="Asia/Tokyo">
                    <div class="clock-city">Tokyo</div>
                    <div class="clock-time"></div>
                    <div class="clock-date"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Update the quick stats section -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="stat-card" data-tooltip="Total number of articles in the database">
                <div class="stat-icon">
                    <i class="fas fa-newspaper"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.total_articles|default(0) }}</div>
                    <div class="stat-label">Total Articles</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" data-tooltip="Articles collected in the last 24 hours">
                <div class="stat-icon">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.articles_today|default(0) }}</div>
                    <div class="stat-label">Articles Today</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" data-tooltip="Number of active keyword groups">
                <div class="stat-icon">
                    <i class="fas fa-tags"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ stats.keyword_groups|default(0) }}</div>
                    <div class="stat-label">Keyword Groups</div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="stat-card" data-tooltip="Total topics being monitored">
                <div class="stat-icon">
                    <i class="fas fa-folder"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value">{{ active_topics|length }}</div>
                    <div class="stat-label">Topics</div>
                </div>
            </div>
        </div>
    </div>

    <!-- After the stats cards, before the world clock -->
    <div class="row mb-4">
        <!-- Quick Links Panel -->
        <div class="col-md-6">
            <div class="card h-100" data-tooltip="Quick access to key features">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-link"></i> What do you want to do today?
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group">
                        <a href="/collect" class="list-group-item list-group-item-action"
                            data-tooltip="Search for news articles">
                             <i class="fas fa-newspaper me-2"></i> News Search
                        </a>
                        <a href="/dashboard" class="list-group-item list-group-item-action"
                            data-tooltip="Monitor academic papers and research">
                             <i class="fas  fa-graduation-cap me-2"></i> Journal Monitor
                        </a>
                        <a href="/keyword-alerts" class="list-group-item list-group-item-action"
                           data-tooltip="View keyword alerts and notifications">
                            <i class="fas fa-bell me-2"></i> Keyword Alerts
                        </a>
                        <a href="/keyword-monitor" class="list-group-item list-group-item-action"
                           data-tooltip="Configure keyword monitoring settings">
                            <i class="fas fa-cogs me-2"></i> Configure Keywords
                        </a>
                        <a href="/research" class="list-group-item list-group-item-action"
                           data-tooltip="Analyze individual articles in detail">
                            <i class="fas fa-microscope me-2"></i> Analyze Article
                        </a>
                        <a href="/analytics" class="list-group-item list-group-item-action"
                           data-tooltip="View trends and insights from collected data">
                            <i class="fas fa-chart-line me-2"></i> Visualize Trends
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- System Status Panel -->
        <div class="col-md-6">
            <div class="card h-100" data-tooltip="System health and status information">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-heartbeat"></i> System Status
                    </h5>
                </div>
                <div class="card-body">
                    <ul class="list-group">
                        <li class="list-group-item d-flex justify-content-between align-items-center"
                            data-tooltip="Current API operational status">
                            <span>API Status</span>
                            <span class="badge {{ api_status.status }}" id="apiStatus">
                                <i class="fas fa-{{ 'check-circle' if api_status.status == 'success' 
                                                else 'exclamation-triangle' if api_status.status == 'warning'
                                                else 'times-circle' }}"></i> 
                                {{ api_status.message }}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center"
                            data-tooltip="Auto-polling status">
                            <span>Auto-polling</span>
                            <span class="badge" id="pollingStatus">
                                <i class="fas fa-circle"></i> Loading...
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center"
                            data-tooltip="API request usage">
                            <span>API Requests</span>
                            <span class="badge bg-primary" id="requestStatus">
                                <i class="fas fa-chart-line"></i> 
                                <span id="requestCount">...</span>/<span id="requestLimit">...</span>
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center"
                            data-tooltip="Database connection status">
                            <span>Database</span>
                            <span class="badge {{ db_status.status }}" id="dbStatus">
                                <i class="fas fa-database"></i> {{ db_status.message }}
                            </span>
                        </li>
                        <li class="list-group-item d-flex justify-content-between align-items-center"
                            data-tooltip="Time since last system update">
                            <span>Last Update</span>
                            <span class="text-muted small" id="lastUpdate" 
                                  data-last-check="{{ last_check_time }}"
                                  data-tooltip="Time since last system update">
                                {{ last_check_time|timeago if last_check_time else 'Never' }}
                            </span>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Update the styling of the remaining topics panel -->
    <div class="card mb-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="mb-0">
                <i class="fas fa-layer-group"></i> Active Topics
            </h5>
            <button class="btn btn-soft-primary" onclick="window.location.href='/create-topic'">
                <i class="fas fa-plus"></i> New Topic
            </button>
        </div>
        <div class="card-body p-0">
            {% if active_topics %}
            <div class="table-responsive">
                <table class="table table-hover mb-0">
                    <thead>
                        <tr>
                            <th>Topic Name</th>
                            <th>Article Count</th>
                            <th>Last Article Added</th>
                            <th class="text-end">Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for topic in active_topics %}
                        <tr>
                            <td>
                                <div class="d-flex align-items-center">
                                    <span class="topic-icon">
                                        <i class="fas fa-layer-group text-primary opacity-75"></i>
                                    </span>
                                    <span class="ms-2">{{ topic.name }}</span>
                                </div>
                            </td>
                            <td>
                                <span class="badge bg-soft-primary">
                                    {{ topic.article_count }} articles
                                </span>
                            </td>
                            <td>
                                <span class="text-muted small">
                                    {{ topic.last_article_date|timeago if topic.last_article_date else 'Never' }}
                                </span>
                            </td>
                            <td class="text-end">
                                <div class="btn-group">
                                    <a href="/analytics?topic={{ topic.name|urlencode }}" 
                                       class="btn btn-sm btn-soft-primary"
                                       data-tooltip="View topic analytics">
                                        <i class="fas fa-chart-line"></i>
                                    </a>
                                    <a href="/database-editor?topic={{ topic.name|urlencode }}" 
                                       class="btn btn-sm btn-soft-primary"
                                       data-tooltip="Edit Article DB">
                                        <i class="fas fa-database"></i>
                                    </a>
                                    <a href="/create-topic?topic={{ topic.name|urlencode }}" 
                                       class="btn btn-sm btn-soft-primary"
                                       data-tooltip="Manage topic settings">
                                        <i class="fas fa-cog"></i>
                                    </a>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <div class="text-center py-4">
                <p class="text-muted mb-0">
                    <i class="fas fa-info-circle"></i> No active topics found.
                    <a href="/create-topic" class="text-primary">Create your first topic</a> to get started.
                </p>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Single source of truth for update intervals
    const UPDATE_INTERVALS = {
        CLOCKS: 1000,    // 1 second
        STATUS: 60000,   // 1 minute
        SYSTEM: 60000    // 1 minute
    };

    // Add these functions at the top of the script section
    async function updateAllStatuses() {
        try {
            const response = await fetch('/api/keyword-monitor/settings');
            if (response.ok) {
                const data = await response.json();
                console.log('API Settings response:', data);  // Debug the full response
                
                // Update Request Counter with proper styling
                const requestCount = document.getElementById('requestCount');
                const requestLimit = document.getElementById('requestLimit');
                const requestStatus = document.getElementById('requestStatus');
                
                if (requestCount && requestLimit && requestStatus) {
                    console.log('Current requests_today:', data.requests_today);
                    console.log('Current daily_request_limit:', data.daily_request_limit);
                    requestCount.textContent = data.requests_today || '0';
                    requestLimit.textContent = data.daily_request_limit || '100';
                    
                    // Update badge styling based on usage
                    const usage = (data.requests_today / data.daily_request_limit) * 100;
                    console.log('Usage percentage:', usage);
                    requestStatus.className = 'badge ' + (
                        usage >= 100 ? 'bg-danger' :
                        usage >= 80 ? 'bg-warning' :
                        'bg-primary'
                    );
                    
                    if (data.last_error && (
                        data.last_error.includes("Rate limit exceeded") || 
                        data.last_error.includes("limit reached")
                    )) {
                        requestStatus.classList.add('text-warning');
                    }
                }

                // Update API Status
                const apiStatus = document.getElementById('apiStatus');
                if (apiStatus) {
                    if (data.last_error && (
                        data.last_error.includes("Rate limit exceeded") || 
                        data.last_error.includes("limit reached")
                    )) {
                        setStatusBadge(apiStatus, 'bg-warning', 'exclamation-triangle', 'Rate Limited');
                    } else {
                        setStatusBadge(apiStatus, 'bg-success', 'check-circle', 'Operational');
                    }
                }
                
                // Update Polling Status
                const pollingStatus = document.getElementById('pollingStatus');
                if (pollingStatus) {
                    if (data.is_enabled) {
                        setStatusBadge(pollingStatus, 'bg-success', 'circle', 'Auto-polling: Enabled');
                    } else {
                        setStatusBadge(pollingStatus, 'bg-warning', 'circle', 'Auto-polling: Disabled');
                    }
                }
            }
        } catch (error) {
            console.error('Error updating statuses:', error);
            setDefaultStatuses();
        }
    }

    // World Clock Update Function
    function updateClocks() {
        const clockElements = document.querySelectorAll('.clock-item');
        const now = new Date();
        
        clockElements.forEach(element => {
            const timezone = element.dataset.timezone;
            const timeElement = element.querySelector('.clock-time');
            const dateElement = element.querySelector('.clock-date');
            
            try {
                const timeStr = now.toLocaleTimeString('en-US', {
                    timeZone: timezone,
                    hour: '2-digit',
                    minute: '2-digit',
                    hour12: true
                });
                
                const dateStr = now.toLocaleDateString('en-US', {
                    timeZone: timezone,
                    month: 'short',
                    day: 'numeric'
                });
                
                const tzStr = now.toLocaleString('en-US', {
                    timeZone: timezone,
                    timeZoneName: 'short'
                }).split(' ').pop();
                
                timeElement.textContent = timeStr;
                dateElement.textContent = `${dateStr} ${tzStr}`;
                
            } catch (e) {
                console.error(`Error updating clock for timezone ${timezone}:`, e);
                timeElement.textContent = '--:--';
                dateElement.textContent = 'Unavailable';
            }
        });
    }

    // Update the initialization code
    document.addEventListener('DOMContentLoaded', function() {
        // Initial updates
        updateAllStatuses();
        updateClocks();
        
        // Set up intervals
        setInterval(updateAllStatuses, 60000);  // Update all statuses every minute
        setInterval(updateClocks, 60000);
        
        // Add hover effects to status badges
        document.querySelectorAll('.badge').forEach(element => {
            element.addEventListener('mouseenter', () => element.style.transform = 'scale(1.05)');
            element.addEventListener('mouseleave', () => element.style.transform = 'scale(1)');
        });
    });

    function setStatusBadge(element, className, icon, text) {
        element.className = `badge ${className}`;
        element.innerHTML = `<i class="fas fa-${icon}"></i> ${text}`;
    }

    function setDefaultStatuses() {
        const elements = {
            apiStatus: ['warning', 'circle', 'API Status: Unknown'],
            pollingStatus: ['warning', 'circle', 'Auto-polling: Unknown'],
            requestStatus: ['warning', 'chart-line', 'API Requests: Unknown']
        };

        for (const [id, [className, icon, text]] of Object.entries(elements)) {
            const element = document.getElementById(id);
            if (element) {
                setStatusBadge(element, className, icon, text);
            }
        }
    }
</script>

<!-- Add Font Awesome for the clock icon -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
{% endblock %}
