version: '3.8'

services:
  aunooai-dev:
    image: aunooai:latest
    build:
      context: .
      args:
        APP_VERSION: $(cat version.txt || echo "dev")
        APP_GIT_BRANCH: $(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "dev")
        APP_BUILD_DATE: $(date -u +'%Y-%m-%d %H:%M:%S')
    ports:
      - "6005:6005"
    volumes:
      - aunooai_dev_data:/app/app/data
      - aunooai_dev_reports:/app/reports
    environment:
      - PORT=6005
      - INSTANCE=dev
      - ADMIN_PASSWORD=admin

  aunooai-prod:
    image: aunooai:latest
    build:
      context: .
      args:
        APP_VERSION: $(cat version.txt || echo "prod")
        APP_GIT_BRANCH: $(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "main")
        APP_BUILD_DATE: $(date -u +'%Y-%m-%d %H:%M:%S')
    ports:
      - "5008:5008"
    volumes:
      - aunooai_prod_data:/app/app/data
      - aunooai_prod_reports:/app/reports
    environment:
      - PORT=5008
      - INSTANCE=prod
      - ADMIN_PASSWORD=admin
    profiles: ["prod"]

  aunooai-staging:
    image: aunooai:latest
    build:
      context: .
      args:
        APP_VERSION: $(cat version.txt || echo "staging")
        APP_GIT_BRANCH: $(git rev-parse --abbrev-ref HEAD 2>/dev/null || echo "staging")
        APP_BUILD_DATE: $(date -u +'%Y-%m-%d %H:%M:%S')
    ports:
      - "5009:5009"
    volumes:
      - aunooai_staging_data:/app/app/data
      - aunooai_staging_reports:/app/reports
    environment:
      - PORT=5009
      - INSTANCE=staging
      - ADMIN_PASSWORD=admin
    profiles: ["staging"]

volumes:
  aunooai_dev_data:
  aunooai_dev_reports:
  aunooai_prod_data:
  aunooai_prod_reports:
  aunooai_staging_data:
  aunooai_staging_reports: 