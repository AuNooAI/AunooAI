2025-11-04 09:39:37,793 - app.config.settings - INFO - Checking config files:
2025-11-04 09:39:37,793 - app.config.settings - INFO - Config path: /home/orochford/tenants/multi.aunoo.ai/app/config/config.json
2025-11-04 09:39:37,793 - app.config.settings - INFO - Config sample path: /home/orochford/tenants/multi.aunoo.ai/app/config/config.json.sample
2025-11-04 09:39:37,822 - app.database - INFO - Database initialized: /home/orochford/tenants/multi.aunoo.ai/app/data/fnaapp.db
2025-11-04 09:39:37,822 - app.database - INFO - Creating PostgreSQL connection: multi
2025-11-04 09:39:37,848 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-11-04 09:39:37,848 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-11-04 09:39:37,848 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:37,848 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:37,848 INFO sqlalchemy.engine.Engine select current_schema()
2025-11-04 09:39:37,848 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-11-04 09:39:37,848 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:37,848 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:37,848 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-11-04 09:39:37,848 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-11-04 09:39:37,848 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:37,848 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:37,849 - app.database - INFO - Database connection pool ready for fnaapp.db
/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/pydantic/_internal/_generate_schema.py:2249: UnsupportedFieldAttributeWarning: The 'default' attribute with value None was provided to the `Field()` function, which has no effect in the context it was used. 'default' is field-specific metadata, and can only be attached to a model field using `Annotated` metadata or by assignment. This may have happened because an `Annotated` type alias using the `type` statement was used, or if the `Field()` function was attached to a single member of a union type.
  warnings.warn(
2025-11-04 09:39:39,998 - app.ai_models - INFO - Removed environment variables for models not in config:
2025-11-04 09:39:39,998 - app.ai_models - INFO -   - OPENAI_API_KEY_GPT_3.5_TURBO (gpt-3.5-turbo, openai)
2025-11-04 09:39:40,021 - app.database - INFO - Database initialized: /home/orochford/tenants/multi.aunoo.ai/app/data/fnaapp.db
2025-11-04 09:39:40,021 - app.database - INFO - Creating PostgreSQL connection: multi
2025-11-04 09:39:40,028 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-11-04 09:39:40,028 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-11-04 09:39:40,028 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:40,028 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:40,028 INFO sqlalchemy.engine.Engine select current_schema()
2025-11-04 09:39:40,028 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-11-04 09:39:40,028 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:40,028 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:40,028 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-11-04 09:39:40,028 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-11-04 09:39:40,028 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:40,028 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:40,029 - app.database - INFO - Database connection pool ready for fnaapp.db
2025-11-04 09:39:40,345 - app.vector_store_chromadb_backup - INFO - ChromaDB thread pool initialized with 4 workers
2025-11-04 09:39:40,345 - app.vector_store - INFO - Vector store: Using PostgreSQL pgvector implementation
2025-11-04 09:39:41,045 - app.database - INFO - Database initialized: /home/orochford/tenants/multi.aunoo.ai/app/data/fnaapp.db
2025-11-04 09:39:41,045 - app.database - INFO - Creating PostgreSQL connection: multi
2025-11-04 09:39:41,056 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-11-04 09:39:41,056 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-11-04 09:39:41,056 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,056 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,057 INFO sqlalchemy.engine.Engine select current_schema()
2025-11-04 09:39:41,057 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-11-04 09:39:41,057 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,057 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,057 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-11-04 09:39:41,057 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-11-04 09:39:41,057 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,057 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,057 - app.database - INFO - Database connection pool ready for fnaapp.db
2025-11-04 09:39:41,076 - app.security.oauth - WARNING - Google OAuth not configured - missing GOOGLE_CLIENT_ID or GOOGLE_CLIENT_SECRET
2025-11-04 09:39:41,076 - app.security.oauth - WARNING - GitHub OAuth not configured - missing GITHUB_CLIENT_ID or GITHUB_CLIENT_SECRET
2025-11-04 09:39:41,076 - app.security.oauth - INFO - OAuth providers configured: []
2025-11-04 09:39:41,082 - app.database - INFO - Database initialized: /home/orochford/tenants/multi.aunoo.ai/app/data/fnaapp.db
2025-11-04 09:39:41,082 - app.database - INFO - Creating PostgreSQL connection: multi
2025-11-04 09:39:41,092 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-11-04 09:39:41,092 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-11-04 09:39:41,092 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,092 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,093 INFO sqlalchemy.engine.Engine select current_schema()
2025-11-04 09:39:41,093 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-11-04 09:39:41,093 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,093 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,093 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-11-04 09:39:41,093 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-11-04 09:39:41,093 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,093 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,094 - app.database - INFO - Database connection pool ready for fnaapp.db
2025-11-04 09:39:41,094 - app.security.oauth - WARNING - Google OAuth not configured - missing GOOGLE_CLIENT_ID or GOOGLE_CLIENT_SECRET
2025-11-04 09:39:41,094 - app.security.oauth - WARNING - GitHub OAuth not configured - missing GITHUB_CLIENT_ID or GITHUB_CLIENT_SECRET
2025-11-04 09:39:41,094 - app.security.oauth - INFO - OAuth providers configured: []
2025-11-04 09:39:41,094 - app.core.app_factory - INFO - OAuth providers initialized: []
2025-11-04 09:39:41,123 - app.database - INFO - Database initialized: /home/orochford/tenants/multi.aunoo.ai/app/data/fnaapp.db
2025-11-04 09:39:41,123 - app.database - INFO - Creating PostgreSQL connection: multi
2025-11-04 09:39:41,132 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-11-04 09:39:41,132 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-11-04 09:39:41,132 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,132 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,132 INFO sqlalchemy.engine.Engine select current_schema()
2025-11-04 09:39:41,132 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-11-04 09:39:41,132 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,132 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,132 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-11-04 09:39:41,132 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-11-04 09:39:41,133 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,133 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,133 - app.database - INFO - Database connection pool ready for fnaapp.db
2025-11-04 09:39:41,133 - app.services.feed_group_service - INFO - FeedGroupService initialized
2025-11-04 09:39:41,134 - app.database - INFO - Database initialized: /home/orochford/tenants/multi.aunoo.ai/app/data/fnaapp.db
2025-11-04 09:39:41,134 - app.database - INFO - Creating PostgreSQL connection: multi
2025-11-04 09:39:41,151 INFO sqlalchemy.engine.Engine select pg_catalog.version()
2025-11-04 09:39:41,151 - sqlalchemy.engine.Engine - INFO - select pg_catalog.version()
2025-11-04 09:39:41,152 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,152 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,153 INFO sqlalchemy.engine.Engine select current_schema()
2025-11-04 09:39:41,153 - sqlalchemy.engine.Engine - INFO - select current_schema()
2025-11-04 09:39:41,153 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,153 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,155 INFO sqlalchemy.engine.Engine show standard_conforming_strings
2025-11-04 09:39:41,155 - sqlalchemy.engine.Engine - INFO - show standard_conforming_strings
2025-11-04 09:39:41,155 INFO sqlalchemy.engine.Engine [raw sql] {}
2025-11-04 09:39:41,155 - sqlalchemy.engine.Engine - INFO - [raw sql] {}
2025-11-04 09:39:41,156 - app.database - INFO - Database connection pool ready for fnaapp.db
2025-11-04 09:39:41,157 - app.services.feed_group_service - INFO - FeedGroupService initialized
2025-11-04 09:39:41,157 - app.services.unified_feed_service - INFO - ArXiv collector initialized successfully
2025-11-04 09:39:41,157 - app.collectors.bluesky_collector - ERROR - Bluesky credentials not found in environment
2025-11-04 09:39:41,157 - app.services.unified_feed_service - WARNING - Failed to initialize Bluesky collector: Bluesky credentials not configured
2025-11-04 09:39:41,157 - app.services.unified_feed_service - INFO - TheNewsAPI collector initialized successfully
2025-11-04 09:39:41,158 - app.collectors.newsdata_collector - ERROR - NewsData.io API key not found in environment
2025-11-04 09:39:41,158 - app.services.unified_feed_service - WARNING - Failed to initialize NewsData.io collector: NewsData.io API key not configured
2025-11-04 09:39:41,158 - app.services.unified_feed_service - INFO - UnifiedFeedService initialized
2025-11-04 09:39:41,273 - app.core.routers - INFO - All routers registered successfully
2025-11-04 09:39:41,273 - app.startup - INFO - Initializing application...
2025-11-04 09:39:41,274 - app.startup - INFO - Loaded environment variables from: /home/orochford/tenants/multi.aunoo.ai/.env
2025-11-04 09:39:41,274 - app.startup - INFO - Firecrawl API key found: fc-b...23fe
2025-11-04 09:39:41,276 - app.ai_models - INFO - ðŸŽ¯ Found 5 configured models: ['gpt-4.1-mini', 'gpt-4o', 'gpt-4o-mini', 'gpt-4.1', 'gpt-4.1-nano']
2025-11-04 09:39:41,276 - app.startup - INFO - Successfully configured AI models:
2025-11-04 09:39:41,276 - app.startup - INFO -   - gpt-4.1-mini
2025-11-04 09:39:41,276 - app.startup - INFO -   - gpt-4o
2025-11-04 09:39:41,276 - app.startup - INFO -   - gpt-4o-mini
2025-11-04 09:39:41,276 - app.startup - INFO -   - gpt-4.1
2025-11-04 09:39:41,277 - app.startup - INFO -   - gpt-4.1-nano
2025-11-04 09:39:41,438 - app.startup - INFO - Firecrawl v2 module is available
2025-11-04 09:39:41,438 - app.startup - INFO - FIRECRAWL_API_KEY found: fc-b...23fe
2025-11-04 09:39:41,438 - app.startup - INFO - PROVIDER_FIRECRAWL_KEY found: fc-b...23fe
2025-11-04 09:39:41,438 - app.startup - INFO - Firecrawl API key verified successfully
2025-11-04 09:39:41,438 - app.core.app_factory - INFO - Application initialization completed successfully
2025-11-04 09:39:41,438 - app.core.app_factory - INFO - FastAPI application created and configured
2025-11-04 09:39:41,458 - main - INFO - Prompt routes included
Starting FastAPI on http://127.0.0.1:10003  (env = production)
2025-11-04 09:39:41,515 - app.services.async_db - INFO - AsyncDatabase initialized for PostgreSQL: multi
2025-11-04 09:39:41,523 - app.services.async_db - INFO - Initializing PostgreSQL async pool with 10 connections
2025-11-04 09:39:41,643 - app.services.async_db - INFO - PostgreSQL async database pool initialized successfully
2025-11-04 09:39:41,643 - main - INFO - Async database initialized successfully
2025-11-04 09:39:41,643 - app.startup - INFO - Initializing application...
2025-11-04 09:39:41,644 - app.startup - INFO - Loaded environment variables from: /home/orochford/tenants/multi.aunoo.ai/.env
2025-11-04 09:39:41,644 - app.startup - INFO - Firecrawl API key found: fc-b...23fe
2025-11-04 09:39:41,646 - app.ai_models - INFO - ðŸŽ¯ Found 5 configured models: ['gpt-4.1-mini', 'gpt-4o', 'gpt-4o-mini', 'gpt-4.1', 'gpt-4.1-nano']
2025-11-04 09:39:41,646 - app.startup - INFO - Successfully configured AI models:
2025-11-04 09:39:41,646 - app.startup - INFO -   - gpt-4.1-mini
2025-11-04 09:39:41,646 - app.startup - INFO -   - gpt-4o
2025-11-04 09:39:41,646 - app.startup - INFO -   - gpt-4o-mini
2025-11-04 09:39:41,646 - app.startup - INFO -   - gpt-4.1
2025-11-04 09:39:41,646 - app.startup - INFO -   - gpt-4.1-nano
2025-11-04 09:39:41,646 - app.startup - INFO - Firecrawl v2 module is available
2025-11-04 09:39:41,646 - app.startup - INFO - FIRECRAWL_API_KEY found: fc-b...23fe
2025-11-04 09:39:41,646 - app.startup - INFO - PROVIDER_FIRECRAWL_KEY found: fc-b...23fe
2025-11-04 09:39:41,646 - app.startup - INFO - Firecrawl API key verified successfully
2025-11-04 09:39:41,646 - main - INFO - Application initialized successfully
2025-11-04 09:39:41,646 - main - INFO - Scheduled keyword monitor to start in 5 seconds
[Errno 98] error while attempting to bind on address ('127.0.0.1', 10003): address already in use
2025-11-04 09:39:41,646 - main - INFO - Application shutting down...
2025-11-04 09:39:41,646 - app.services.async_db - INFO - Closing async database connection pool
2025-11-04 09:39:41,647 - app.services.async_db - INFO - PostgreSQL async pool closed
2025-11-04 09:39:41,647 - app.services.async_db - INFO - Async database pool closed
2025-11-04 09:39:41,647 - main - INFO - Async database pool closed
2025-11-04 09:39:41,647 - main - INFO - Application shutdown complete
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      2025-11-04 09:39:53,681 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:39:53,681 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:39:53,682 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:39:53,682 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:39:53,682 INFO sqlalchemy.engine.Engine [cached since 106.7s ago] ('admin',)
2025-11-04 09:39:53,682 - sqlalchemy.engine.Engine - INFO - [cached since 106.7s ago] ('admin',)
2025-11-04 09:39:53,682 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:39:53,682 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:39:53,682 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET /change_password HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:39:55,209 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:39:55,209 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:39:55,209 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:39:55,209 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:39:55,209 INFO sqlalchemy.engine.Engine [cached since 108.3s ago] ('admin',)
2025-11-04 09:39:55,209 - sqlalchemy.engine.Engine - INFO - [cached since 108.3s ago] ('admin',)
2025-11-04 09:39:55,209 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:39:55,209 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:39:55,209 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET /change_password HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:40:07,024 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:40:07,024 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:40:07,024 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:40:07,024 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:40:07,024 INFO sqlalchemy.engine.Engine [cached since 120.1s ago] ('admin',)
2025-11-04 09:40:07,024 - sqlalchemy.engine.Engine - INFO - [cached since 120.1s ago] ('admin',)
2025-11-04 09:40:07,024 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:40:07,024 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:40:07,024 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET /change_password HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:40:09,366 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:40:09,366 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:40:09,366 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:40:09,366 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:40:09,366 INFO sqlalchemy.engine.Engine [cached since 122.4s ago] ('admin',)
2025-11-04 09:40:09,366 - sqlalchemy.engine.Engine - INFO - [cached since 122.4s ago] ('admin',)
2025-11-04 09:40:09,366 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:40:09,366 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:40:09,366 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET /change_password HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:40:11,672 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:40:11,672 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:40:11,672 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:40:11,672 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:40:11,672 INFO sqlalchemy.engine.Engine [cached since 124.7s ago] ('admin',)
2025-11-04 09:40:11,672 - sqlalchemy.engine.Engine - INFO - [cached since 124.7s ago] ('admin',)
2025-11-04 09:40:11,673 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:40:11,673 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:40:11,673 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:40:14,241 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:40:14,241 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:40:14,242 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:40:14,242 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:40:14,242 INFO sqlalchemy.engine.Engine [cached since 127.3s ago] ('admin',)
2025-11-04 09:40:14,242 - sqlalchemy.engine.Engine - INFO - [cached since 127.3s ago] ('admin',)
2025-11-04 09:40:14,242 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:40:14,242 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:40:14,242 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:43:08,820 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:43:08,820 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:43:08,820 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:43:08,820 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:43:08,820 INFO sqlalchemy.engine.Engine [cached since 301.9s ago] ('admin',)
2025-11-04 09:43:08,820 - sqlalchemy.engine.Engine - INFO - [cached since 301.9s ago] ('admin',)
2025-11-04 09:43:08,821 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:43:08,821 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:43:08,821 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:44:56,475 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:44:56,475 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:44:56,475 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.force_password_change, users.completed_onboarding 
FROM users 
WHERE users.username = ?
2025-11-04 09:44:56,475 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.force_password_change, users.completed_onboarding 
FROM users 
WHERE users.username = ?
2025-11-04 09:44:56,475 INFO sqlalchemy.engine.Engine [cached since 773.9s ago] ('admin',)
2025-11-04 09:44:56,475 - sqlalchemy.engine.Engine - INFO - [cached since 773.9s ago] ('admin',)
2025-11-04 09:44:56,475 INFO sqlalchemy.engine.Engine COMMIT
2025-11-04 09:44:56,475 - sqlalchemy.engine.Engine - INFO - COMMIT
INFO:     90.250.59.20:0 - "POST /login HTTP/1.1" 302 Found
2025-11-04 09:44:56,709 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:44:56,709 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:44:56,709 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:44:56,709 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:44:56,709 INFO sqlalchemy.engine.Engine [cached since 409.8s ago] ('admin',)
2025-11-04 09:44:56,709 - sqlalchemy.engine.Engine - INFO - [cached since 409.8s ago] ('admin',)
2025-11-04 09:44:56,710 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:44:56,710 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:44:56,710 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET /change_password HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
INFO:     90.250.59.20:0 - "GET /health/dashboard HTTP/1.1" 307 Temporary Redirect
INFO:     90.250.59.20:0 - "GET /login HTTP/1.1" 200 OK
2025-11-04 09:45:35,999 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:45:35,999 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:45:35,999 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:45:35,999 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:45:35,999 INFO sqlalchemy.engine.Engine [cached since 449s ago] ('admin',)
2025-11-04 09:45:35,999 - sqlalchemy.engine.Engine - INFO - [cached since 449s ago] ('admin',)
2025-11-04 09:45:35,999 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:45:35,999 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:45:35,999 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:45:54,248 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:45:54,248 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:45:54,248 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:45:54,248 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:45:54,248 INFO sqlalchemy.engine.Engine [cached since 467.3s ago] ('admin',)
2025-11-04 09:45:54,248 - sqlalchemy.engine.Engine - INFO - [cached since 467.3s ago] ('admin',)
2025-11-04 09:45:54,248 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:45:54,248 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:45:54,248 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:23,802 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:46:23,802 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:46:23,802 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:23,802 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:23,802 INFO sqlalchemy.engine.Engine [cached since 496.8s ago] ('admin',)
2025-11-04 09:46:23,802 - sqlalchemy.engine.Engine - INFO - [cached since 496.8s ago] ('admin',)
2025-11-04 09:46:23,802 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:23,802 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:46:23,802 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:25,307 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:46:25,307 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:46:25,307 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:25,307 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:25,307 INFO sqlalchemy.engine.Engine [cached since 498.3s ago] ('admin',)
2025-11-04 09:46:25,307 - sqlalchemy.engine.Engine - INFO - [cached since 498.3s ago] ('admin',)
2025-11-04 09:46:25,307 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:25,307 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:46:25,307 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:26,941 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:46:26,941 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:46:26,941 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:26,941 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:26,941 INFO sqlalchemy.engine.Engine [cached since 500s ago] ('admin',)
2025-11-04 09:46:26,941 - sqlalchemy.engine.Engine - INFO - [cached since 500s ago] ('admin',)
2025-11-04 09:46:26,941 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:26,941 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:46:26,941 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:27,635 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:46:27,635 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:46:27,636 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:27,636 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:27,636 INFO sqlalchemy.engine.Engine [cached since 500.7s ago] ('admin',)
2025-11-04 09:46:27,636 - sqlalchemy.engine.Engine - INFO - [cached since 500.7s ago] ('admin',)
2025-11-04 09:46:27,636 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:27,636 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:46:27,636 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:28,233 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:46:28,233 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:46:28,233 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:28,233 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:28,233 INFO sqlalchemy.engine.Engine [cached since 501.3s ago] ('admin',)
2025-11-04 09:46:28,233 - sqlalchemy.engine.Engine - INFO - [cached since 501.3s ago] ('admin',)
2025-11-04 09:46:28,234 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:28,234 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:46:28,234 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:28,889 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:46:28,889 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:46:28,889 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:28,889 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:28,889 INFO sqlalchemy.engine.Engine [cached since 501.9s ago] ('admin',)
2025-11-04 09:46:28,889 - sqlalchemy.engine.Engine - INFO - [cached since 501.9s ago] ('admin',)
2025-11-04 09:46:28,889 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:28,890 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:46:28,890 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:29,549 INFO sqlalchemy.engine.Engine BEGIN (implicit)
2025-11-04 09:46:29,549 - sqlalchemy.engine.Engine - INFO - BEGIN (implicit)
2025-11-04 09:46:29,550 INFO sqlalchemy.engine.Engine SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:29,550 - sqlalchemy.engine.Engine - INFO - SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?
2025-11-04 09:46:29,550 INFO sqlalchemy.engine.Engine [cached since 502.6s ago] ('admin',)
2025-11-04 09:46:29,550 - sqlalchemy.engine.Engine - INFO - [cached since 502.6s ago] ('admin',)
2025-11-04 09:46:29,550 - app.database - ERROR - Error executing get_user_by_username: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:46:29,550 INFO sqlalchemy.engine.Engine ROLLBACK
2025-11-04 09:46:29,550 - sqlalchemy.engine.Engine - INFO - ROLLBACK
INFO:     90.250.59.20:0 - "GET / HTTP/1.1" 500 Internal Server Error
Exception in ASGI application
Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlite3.OperationalError: no such column: users.email

The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/protocols/http/httptools_impl.py", line 409, in run_asgi
    result = await app(  # type: ignore[func-returns-value]
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/uvicorn/middleware/proxy_headers.py", line 60, in __call__
    return await self.app(scope, receive, send)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/applications.py", line 1133, in __call__
    await super().__call__(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/applications.py", line 113, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 186, in __call__
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/errors.py", line 164, in __call__
    await self.app(scope, receive, _send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/cors.py", line 85, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 182, in __call__
    with recv_stream, send_stream, collapse_excgroups():
  File "/usr/lib/python3.12/contextlib.py", line 158, in __exit__
    self.gen.throw(value)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_utils.py", line 85, in collapse_excgroups
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 184, in __call__
    response = await self.dispatch_func(request, call_next)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/main.py", line 2426, in add_app_info
    response = await call_next(request)
               ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 159, in call_next
    raise app_exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/base.py", line 144, in coro
    await self.app(scope, receive_or_disconnect, send_no_error)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/sessions.py", line 85, in __call__
    await self.app(scope, receive, send_wrapper)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/middleware/exceptions.py", line 63, in __call__
    await wrap_app_handling_exceptions(self.app, conn)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/middleware/asyncexitstack.py", line 18, in __call__
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 716, in __call__
    await self.middleware_stack(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 736, in app
    await route.handle(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/routing.py", line 290, in handle
    await self.app(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 123, in app
    await wrap_app_handling_exceptions(app, request)(scope, receive, send)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 53, in wrapped_app
    raise exc
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/_exception_handler.py", line 42, in wrapped_app
    await app(scope, receive, sender)
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 109, in app
    response = await f(request)
               ^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/routing.py", line 379, in app
    solved_result = await solve_dependencies(
                    ^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/fastapi/dependencies/utils.py", line 675, in solve_dependencies
    solved = await run_in_threadpool(call, **solved_result.values)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/starlette/concurrency.py", line 38, in run_in_threadpool
    return await anyio.to_thread.run_sync(func)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/to_thread.py", line 56, in run_sync
    return await get_async_backend().run_sync_in_worker_thread(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 2485, in run_sync_in_worker_thread
    return await future
           ^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/anyio/_backends/_asyncio.py", line 976, in run
    result = context.run(func, *args)
             ^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/security/session.py", line 41, in verify_session
    user = db.facade.get_user_by_username(username)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 1160, in get_user_by_username
    result = self._execute_with_rollback(stmt, operation_name="get_user_by_username")
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/app/database_query_facade.py", line 110, in _execute_with_rollback
    result = connection.execute(statement)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1419, in execute
    return meth(
           ^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/sql/elements.py", line 526, in _execute_on_connection
    return connection._execute_clauseelement(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1641, in _execute_clauseelement
    ret = self._execute_context(
          ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
    return self._exec_single_context(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
    self._handle_dbapi_exception(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
    self.dialect.do_execute(
  File "/home/orochford/tenants/multi.aunoo.ai/.venv/lib/python3.12/site-packages/sqlalchemy/engine/default.py", line 951, in do_execute
    cursor.execute(statement, parameters)
sqlalchemy.exc.OperationalError: (sqlite3.OperationalError) no such column: users.email
[SQL: SELECT users.username, users.password_hash, users.email, users.role, users.is_active, users.force_password_change, users.completed_onboarding, users.created_at 
FROM users 
WHERE users.username = ?]
[parameters: ('admin',)]
(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-11-04 09:47:20,644 - main - INFO - Application shutting down...
2025-11-04 09:47:20,644 - app.services.async_db - INFO - Closing async database connection pool
2025-11-04 09:47:20,645 - app.services.async_db - INFO - Async database pool closed
2025-11-04 09:47:20,645 - main - INFO - Async database pool closed
2025-11-04 09:47:20,645 - main - INFO - Application shutdown complete
